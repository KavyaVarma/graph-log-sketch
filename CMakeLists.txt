cmake_minimum_required(VERSION 3.11)
project(graph-log-sketch)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_BUILD_TYPE Debug)
include_directories(include)
Include(FetchContent)

FetchContent_Declare(
  Catch2
  GIT_REPOSITORY https://github.com/catchorg/Catch2.git
  GIT_TAG        v3.1.0 # or a later release
)

FetchContent_MakeAvailable(Catch2)

set(GALOIS_ENABLE_DIST ON FORCE BOOL)
set(GALOIS_USE_BARE_MPI ON BOOL)

add_subdirectory(galois EXCLUDE_FROM_ALL)

add_executable(small-tests test/small_tests.cpp)
add_executable(file-tests test/file_tests.cpp)
add_executable(dijkstra-tests test/dijkstra.cpp)
add_executable(bfs-tests test/bfs.cpp)
add_executable(galois-tests test/galois.cpp)
add_executable(galois-bfs-tests test/galois_bfs.cpp)
add_executable(galois-gen-bfs-tests test/galois_gen_bfs.cpp)
add_executable(galois-jaccard-tests test/jaccard.cpp)
add_executable(jaccard microbench/jaccard.cpp)
add_executable(edit_scalability microbench/edit_scalability.cpp)
add_executable(wf2_exact microbench/wf2-exact/main.cpp)
add_executable(wf2_dist microbench/wf2-dist/main.cpp)
add_executable(parallel-small-tests test/p_small_tests.cpp)
target_link_libraries(small-tests PRIVATE Catch2::Catch2WithMain Galois::shmem)
target_link_libraries(file-tests PRIVATE Catch2::Catch2WithMain Galois::shmem)
target_link_libraries(dijkstra-tests PRIVATE Catch2::Catch2WithMain)
target_link_libraries(bfs-tests PRIVATE Catch2::Catch2WithMain Galois::shmem)
target_link_libraries(galois-tests PRIVATE Catch2::Catch2WithMain Galois::shmem)
target_link_libraries(galois-bfs-tests PRIVATE Catch2::Catch2WithMain Galois::shmem lonestar)
target_link_libraries(galois-gen-bfs-tests PRIVATE Catch2::Catch2WithMain Galois::shmem lonestar)
target_link_libraries(galois-jaccard-tests PRIVATE Catch2::Catch2WithMain Galois::shmem lonestar)
target_link_libraries(parallel-small-tests PRIVATE Catch2::Catch2WithMain Galois::shmem)
target_link_libraries(jaccard PRIVATE Galois::shmem lonestar)
target_link_libraries(edit_scalability PRIVATE Galois::shmem lonestar)
target_link_libraries(wf2_exact PRIVATE galois_cusp Galois::shmem lonestar)
target_link_libraries(wf2_dist PRIVATE galois_cusp galois_gluon distbench pangolin Galois::shmem lonestar)
include(CTest)
include(Catch)
catch_discover_tests(small-tests)
catch_discover_tests(file-tests)
catch_discover_tests(dijkstra-tests)
catch_discover_tests(bfs-tests)
catch_discover_tests(galois-tests)
catch_discover_tests(galois-bfs-tests)
catch_discover_tests(galois-jaccard-tests)
catch_discover_tests(galois-gen-bfs-tests)
catch_discover_tests(parallel-small-tests)
